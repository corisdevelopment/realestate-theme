---
import { storyblokEditable, useStoryblokApi } from "@storyblok/astro";
import ListingFilter from '@components/ListingsFilter';

const { blok } = Astro.props;

const storyblokApi = useStoryblokApi();
const { data } = await storyblokApi.get(`cdn/stories`, {
  version: import.meta.env.DEV ? "draft" : "published",
  starts_with: "listings/",
  is_startpage: false,
});

// Set Variables for filter listings
const listings = data.stories;

const residentialListings = listings.filter(
  (listing: any) => listing.content.details[0].category === "residential",
);

const commercialListings = listings.filter(
  (listing: any) => listing.content.details[0].category === "commercial",
);
---

<section class="bg-gray-100 lg:py-4 lg:px-4">
  <div
    class="max-contain mx-auto lg:rounded-md border border-golden-400 bg-gray-100 min-h-[80vh]"
    {...storyblokEditable(blok)}
  >
    <ListingFilter
      client:load
      listings={listings}
      residentialListings={residentialListings}
      commercialListings={commercialListings}
    />
  </div>
</section>
