---
import { storyblokEditable, useStoryblokApi } from "@storyblok/astro";
import { Image } from "astro:assets";

const { blok } = Astro.props;

const storyblokApi = useStoryblokApi();
const { data } = await storyblokApi.get(`cdn/stories`, {
  version: import.meta.env.DEV ? "draft" : "published",
  starts_with: "listings/",
  is_startpage: false,
});

// Set Variables for filter listings
const listings = data.stories;
console.log("ðŸš€ ~ listings:", listings);

const residentialListings = listings.filter(
  (listing: any) => listing.content.details[0].category === "residential",
);

const commercialListings = listings.filter(
  (listing: any) => listing.content.details[0].category === "commercial",
);
console.log("ðŸš€ ~ residentialListings:", commercialListings);

// React State
const url = new URL(Astro.request.url);
const filter = url.searchParams.get('filter') || 'all';

// All listings
const filteredListings = {
  all: listings,
  residential: residentialListings,
  commercial: commercialListings,
}[filter];

// FUNCTION: Get details summary data and format
const getDetailsSummaryFrom = (item: any) => {
  // Check if item has details
  if (item.details.length) {
    const details = [...item.details].shift();
    const list = {
      bedrooms: `${details.bedrooms} Bedroom`,
      fullBaths:
        details.full_baths !== "" ? ` | ${details.full_baths} Full Baths` : "",
      halfBaths:
        details.half_baths !== "" ? ` | ${details.half_baths} Half Baths` : "",
      sqft: details.square_feet !== "" ? ` | ${details.square_feet} sqft` : "",
    };
    return Object.values(list);
  }
};
---

<section class="bg-gray-100 lg:py-4 lg:px-4">
  <div
    class="max-contain mx-auto lg:rounded-md border border-golden-400 bg-gray-100 min-h-[80vh]"
    {...storyblokEditable(blok)}
  >
    <!-- List Header -->
    <div
      class="list-header w-full flex justify-between text-grey-500
      px-4 md:px-8 lg:px-12 py-8 border-b border-golden-200 shadow-sm"
    >
      <!-- Title -->
      <div class="title content-center uppercase font-extralight">
        {
          blok.headline && (
            <h2 class="text-2xl sm:text-3xl md:text-4xl">{blok.headline}</h2>
          )
        }
      </div>
      <!-- Filter Buttons -->
      <form action="" method="get">
        <div class="filters content-center flex gap-2">
        
          <button
            type="submit"
            name="filter"
            value="all"
            class="border border-gray-500 opacity-80 font-medium rounded-lg
        text-xs md:text-sm px-4 md:px-10 py-1.5 md:py-2.5 focus:outline-none flex"
          >
            All
          </button>
          <button
            type="button"
            class="border border-gray-500 opacity-50 font-medium rounded-lg
        text-xs md:text-sm px-4 md:zpx-5 py-1.5 md:py-2.5 focus:outline-none flex"
          >
            Residential
          </button>
          <button
            type="button"
            class="border border-gray-500 opacity-50 font-medium rounded-lg
        text-xs md:text-sm px-4 md:px-5 py-1.5 md:py-2.5 focus:outline-none flex"
          >
            Commercial
          </button>
        </div>
      </form>
    </div>
    <!-- List -->
    <div class="grid gap-8 my-8 px-4 md:px-8">
      {
        // filteredListings.map((listings: any) => 
        //   <p>Hello</p>
        // ) // end map
          
        
          // listings.map((listing: any) => (
          //   <div class="rounded-sm border border-golden-200 bg-white shadow-md p-6">
          //     <div class="grid grid-cols-6 gap-4 md:m-4">
          //       <div class="card-image col-span-6 sm:col-span-3 lg:col-span-2">
          //         <div class="min-h-72 h-full w-full rounded-md overflow-hidden">
          //           <a href={listing.slug}>
          //             <Image
          //               src={listing.content.featured_media[0].image.filename}
          //               inferSize={true}
          //               widths={[540, 720]}
          //               sizes={`(max-with: 720px) 540px, (max-width: 1024) 720px`}
          //               alt={listing.content.featured_media[0].image.alt}
          //               class="flex object-cover h-full"
          //             />
          //           </a>
          //         </div>
          //       </div>
          //       <div
          //         class="card-details col-span-6 sm:col-span-3 lg:col-span-4 
          //       grid grid-rows-3 px-4"
          //       >
          //         <div class="flex-col sm:flex sm:justify-between">
          //           <div class="listing-name">
          //             <h2 class="text-3xl">{listing.name}</h2>
          //           </div>
          //           <div class="status">
          //             <button class="flex rounded-sm px-4 py-1 mt-1 mb-2 md:py-2 text-xs md:text-sm capitalize border border-golden-400 text-golden-400 opacity-75">
          //               <p>{listing.content.details[0].category} | </p>
          //               <span class="text-green-500 pl-1">
          //                 {listing.content.status}
          //               </span>
          //             </button>
          //           </div>
          //         </div>
          //         <div class="listing-details text-2xl font-light pb-2 content-center">
          //           <p>{getDetailsSummaryFrom(listing.content)}</p>
          //         </div>
          //         <div class="card-footer justify-between flex sm:flex-col lg:flex-row">
          //           <p class="text-3xl place-self-end sm:max-lg:place-self-center mr-1 pb-2">
          //             {listing.content.price[0].text}
          //           </p>
          //           <button
          //             class="place-self-end sm:max-lg:place-self-center
          //           px-6 py-1 mt-1 mb-2 md:py-2 lg:px-12
          //           text-xs md:text-sm capitalize
          //           border border-golden-400 text-golden-400 opacity-75 shadow-md"
          //           >
          //             <a
          //               href={listing.slug}
          //               class="text-xl uppercase font-semibold"
          //             >
          //               See Listing
          //             </a>
          //           </button>
          //         </div>
          //       </div>
          //     </div>
          //   </div>
          // )),
          
      }
      
      <!-- {
        listings?.length === 0 && (
          <div class="text-3xl font-light text-center pt-12">
            Sorry No Listings Available
          </div>
        )
      } -->
      <!-- End Loop -->
    </div>
  </div>
</section>
